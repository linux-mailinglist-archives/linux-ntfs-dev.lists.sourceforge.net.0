Return-Path: <linux-ntfs-dev-bounces@lists.sourceforge.net>
X-Original-To: lists+linux-ntfs-dev@lfdr.de
Delivered-To: lists+linux-ntfs-dev@lfdr.de
Received: from lists.sourceforge.net (lists.sourceforge.net [216.105.38.7])
	by mail.lfdr.de (Postfix) with ESMTPS id 9364A3E3C72
	for <lists+linux-ntfs-dev@lfdr.de>; Sun,  8 Aug 2021 21:06:41 +0200 (CEST)
Received: from [127.0.0.1] (helo=sfs-ml-1.v29.lw.sourceforge.com)
	by sfs-ml-1.v29.lw.sourceforge.com with esmtp (Exim 4.90_1)
	(envelope-from <linux-ntfs-dev-bounces@lists.sourceforge.net>)
	id 1mCo7z-0004hk-MA; Sun, 08 Aug 2021 19:06:31 +0000
Received: from [172.30.20.202] (helo=mx.sourceforge.net)
 by sfs-ml-2.v29.lw.sourceforge.com with esmtps
 (TLSv1.2:ECDHE-RSA-AES256-GCM-SHA384:256) (Exim 4.92.3)
 (envelope-from <pali@kernel.org>)
 id 1mClc7-0005f4-Om; Sun, 08 Aug 2021 16:25:27 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
 d=sourceforge.net; s=x; h=Content-Transfer-Encoding:Content-Type:MIME-Version
 :References:In-Reply-To:Message-Id:Date:Subject:To:From:Sender:Reply-To:Cc:
 Content-ID:Content-Description:Resent-Date:Resent-From:Resent-Sender:
 Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:List-Unsubscribe:
 List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=4sJk/OhATbULlayW48rHG+54WdYlb0M4XiK7xoKmGRE=; b=RjBzK2UfDoVaKA6awlUoetz1Y3
 c1Xz7EmprqtfnF4Dx3Nz6VTstEpzr2xW2WdH7LTO4THns2yubhethKabS6IUgnEa0GorXrZpKmU0y
 +ewj+gxlEh5qJB1p11KngmIucRLNKzlTQ4Xb9tN4mMr1EHMjBCm/cQUtPRf89SK8M/Bc=;
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; d=sf.net; s=x
 ;
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:
 In-Reply-To:Message-Id:Date:Subject:To:From:Sender:Reply-To:Cc:Content-ID:
 Content-Description:Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc
 :Resent-Message-ID:List-Id:List-Help:List-Unsubscribe:List-Subscribe:
 List-Post:List-Owner:List-Archive;
 bh=4sJk/OhATbULlayW48rHG+54WdYlb0M4XiK7xoKmGRE=; b=PYbCaGepv08R4UOVafHcBEt0V2
 Fs4IF18PRy1kA9r7iPLJ1DNB76ByohTBr0Uu0PLu9YE1U1KZZFkmE8yRg+r0RsNThZrcr8JtgaQNU
 asKqphdQTB4TTlEvxuLISX+AoqHNfSnW+G2YSZDCSgDB2WsqSDxXcCdC4b26AU+U1uIU=;
Received: from mail.kernel.org ([198.145.29.99])
 by sfi-mx-2.v28.lw.sourceforge.com with esmtps
 (TLSv1.2:ECDHE-RSA-AES256-GCM-SHA384:256) (Exim 4.92.3)
 id 1mClc5-0001vc-Hw; Sun, 08 Aug 2021 16:25:27 +0000
Received: by mail.kernel.org (Postfix) with ESMTPSA id DA04660EE7;
 Sun,  8 Aug 2021 16:25:14 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=k20201202; t=1628439915;
 bh=y+p38IXi4M4D7x3ldT5SvR2OPbx9cSHtqSZfSJc2Zfk=;
 h=From:To:Subject:Date:In-Reply-To:References:From;
 b=omiygZMOfnHVGZb4pf5LQ1AISMQgpo8hBzt1XPXlbcr2KiKk/xK1/QC8z8UVqwr1d
 4Jy0eoyJnI8Cvl7IWzK/XPX9dpGB1fAAx4vuk+jipiW1+UsVlf4f5Oe326O0pisHFA
 z9AsZ2NMLrn/YizILTnl9PYbIdHcmZ15/eSPpZ9wUC2sn/Q70+ClY8WC0/2BG6HXAj
 px94HOOKjVr1u/I7pXslkJnjr4fjXsj7ifrAQKHE0OIMLPknoo6Tq3kMEQdmZqIXdS
 F+iwEXJtZY311qYsdWI1l8xBm7tbdDw1ncM5H2W3ISvZdBejo4vWXBooZKhAYqQ5Od
 RMhL/RJ7NT/7A==
Received: by pali.im (Postfix)
 id DE4691430; Sun,  8 Aug 2021 18:25:12 +0200 (CEST)
From: =?UTF-8?q?Pali=20Roh=C3=A1r?= <pali@kernel.org>
To: linux-fsdevel@vger.kernel.org, linux-ntfs-dev@lists.sourceforge.net,
 linux-cifs@vger.kernel.org, jfs-discussion@lists.sourceforge.net,
 linux-kernel@vger.kernel.org, Alexander Viro <viro@zeniv.linux.org.uk>,
 Jan Kara <jack@suse.cz>, OGAWA Hirofumi <hirofumi@mail.parknet.co.jp>,
 "Theodore Y . Ts'o" <tytso@mit.edu>,
 Luis de Bethencourt <luisbg@kernel.org>,
 Salah Triki <salah.triki@gmail.com>,
 Andrew Morton <akpm@linux-foundation.org>,
 Dave Kleikamp <shaggy@kernel.org>, Anton Altaparmakov <anton@tuxera.com>,
 Pavel Machek <pavel@ucw.cz>,
 =?UTF-8?q?Marek=20Beh=C3=BAn?= <marek.behun@nic.cz>,
 Christoph Hellwig <hch@infradead.org>
Date: Sun,  8 Aug 2021 18:24:34 +0200
Message-Id: <20210808162453.1653-2-pali@kernel.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20210808162453.1653-1-pali@kernel.org>
References: <20210808162453.1653-1-pali@kernel.org>
MIME-Version: 1.0
X-Spam-Score: -0.8 (/)
X-Spam-Report: Spam Filtering performed by mx.sourceforge.net.
 See http://spamassassin.org/tag/ for more details.
 -0.0 SPF_PASS               SPF: sender matches SPF record
 0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from author's
 domain
 -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
 0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.7 DKIMWL_WL_HIGH         DKIMwl.org - High trust sender
X-Headers-End: 1mClc5-0001vc-Hw
X-Mailman-Approved-At: Sun, 08 Aug 2021 19:06:29 +0000
Subject: [Linux-NTFS-Dev] [RFC PATCH 01/20] fat: Fix iocharset=utf8 mount
 option
X-BeenThere: linux-ntfs-dev@lists.sourceforge.net
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: "Discussion related to Linux NTFS development."
 <linux-ntfs-dev.lists.sourceforge.net>
List-Unsubscribe: <https://lists.sourceforge.net/lists/options/linux-ntfs-dev>, 
 <mailto:linux-ntfs-dev-request@lists.sourceforge.net?subject=unsubscribe>
List-Archive: <http://sourceforge.net/mailarchive/forum.php?forum_name=linux-ntfs-dev>
List-Post: <mailto:linux-ntfs-dev@lists.sourceforge.net>
List-Help: <mailto:linux-ntfs-dev-request@lists.sourceforge.net?subject=help>
List-Subscribe: <https://lists.sourceforge.net/lists/listinfo/linux-ntfs-dev>, 
 <mailto:linux-ntfs-dev-request@lists.sourceforge.net?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linux-ntfs-dev-bounces@lists.sourceforge.net

Q3VycmVudGx5IGlvY2hhcnNldD11dGY4IG1vdW50IG9wdGlvbiBpcyBicm9rZW4gYW5kIGVycm9y
IGlzIHByaW50ZWQgdG8KZG1lc2cgd2hlbiBpdCBpcyB1c2VkLiBUbyB1c2UgVVRGLTggYXMgaW9j
aGFyc2V0LCBpdCBpcyByZXF1aXJlZCB0byB1c2UKdXRmOD0xIG1vdW50IG9wdGlvbi4KCkZpeCBp
b2NoYXJzZXQ9dXRmOCBtb3VudCBvcHRpb24gdG8gdXNlIGJlIGVxdWl2YWxlbnQgdG8gdGhlIHV0
Zjg9MSBtb3VudApvcHRpb24gYW5kIHJlbW92ZSBwcmludGluZyBlcnJvciBmcm9tIGRtZXNnLgoK
RkFUIGJ5IGRlZmluaXRpb24gaXMgY2FzZS1pbnNlbnNpdGl2ZSBidXQgY3VycmVudCBMaW51eCBp
bXBsZW1lbnRhdGlvbiBpcwpjYXNlLXNlbnNpdGl2ZSBmb3Igbm9uLUFTQ0lJIGNoYXJhY3RlcnMg
d2hlbiBVVEYtOCBpcyB1c2VkLiBUaGlzIHBhdGNoIGRvZXMKbm90IGNoYW5nZSB0aGlzIFVURi04
IGJlaGF2aW9yLiBPbmx5IG1vcmUgY29tbWVudHMgaW4gZmF0X3V0Zjhfc3RybmljbXAoKQpmdW5j
dGlvbiBhcmUgYWRkZWQgYWJvdXQgaXQuCgpBZnRlciB0aGlzIHBhdGNoIGlvY2hhcnNldD11dGY4
IHN0YXJ0cyB3b3JraW5nLCBzbyB0aGVyZSBpcyBubyBuZWVkIHRvIGhhdmUKc2VwYXJhdGUgY29u
ZmlnIG9wdGlvbiBGQVRfREVGQVVMVF9VVEY4IGFzIEZBVF9ERUZBVUxUX0lPQ0hBUlNFVCBmb3Ig
dXRmOAphbHNvIHN0YXJ0cyB3b3JraW5nLiBTbyByZW1vdmUgcmVkdW5kYW50IGNvbmZpZyBvcHRp
b24gRkFUX0RFRkFVTFRfVVRGOC4KClNpZ25lZC1vZmYtYnk6IFBhbGkgUm9ow6FyIDxwYWxpQGtl
cm5lbC5vcmc+Ci0tLQogZnMvZmF0L0tjb25maWcgICAgICB8IDE1IC0tLS0tLS0tLS0tLS0tLQog
ZnMvZmF0L2Rpci5jICAgICAgICB8IDE3ICsrKysrKystLS0tLS0tLS0tCiBmcy9mYXQvZmF0Lmgg
ICAgICAgIHwgMjIgKysrKysrKysrKysrKysrKysrKysrKwogZnMvZmF0L2lub2RlLmMgICAgICB8
IDI4ICsrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0KIGZzL2ZhdC9uYW1laV92ZmF0LmMgfCAy
NiArKysrKysrKysrKysrKysrKysrLS0tLS0tLQogNSBmaWxlcyBjaGFuZ2VkLCA1OSBpbnNlcnRp
b25zKCspLCA0OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9mcy9mYXQvS2NvbmZpZyBiL2Zz
L2ZhdC9LY29uZmlnCmluZGV4IDY2NTMyYTcxZThmZC4uYTMxNTk0MTM3ZDVlIDEwMDY0NAotLS0g
YS9mcy9mYXQvS2NvbmZpZworKysgYi9mcy9mYXQvS2NvbmZpZwpAQCAtMTAwLDE4ICsxMDAsMyBA
QCBjb25maWcgRkFUX0RFRkFVTFRfSU9DSEFSU0VUCiAKIAkgIEVuYWJsZSBhbnkgY2hhcmFjdGVy
IHNldHMgeW91IG5lZWQgaW4gRmlsZSBTeXN0ZW1zL05hdGl2ZSBMYW5ndWFnZQogCSAgU3VwcG9y
dC4KLQotY29uZmlnIEZBVF9ERUZBVUxUX1VURjgKLQlib29sICJFbmFibGUgRkFUIFVURi04IG9w
dGlvbiBieSBkZWZhdWx0IgotCWRlcGVuZHMgb24gVkZBVF9GUwotCWRlZmF1bHQgbgotCWhlbHAK
LQkgIFNldCB0aGlzIGlmIHlvdSB3b3VsZCBsaWtlIHRvIGhhdmUgInV0ZjgiIG1vdW50IG9wdGlv
biBzZXQKLQkgIGJ5IGRlZmF1bHQgd2hlbiBtb3VudGluZyBGQVQgZmlsZXN5c3RlbXMuCi0KLQkg
IEV2ZW4gaWYgeW91IHNheSBZIGhlcmUgY2FuIGFsd2F5cyBkaXNhYmxlIFVURi04IGZvcgotCSAg
cGFydGljdWxhciBtb3VudCBieSBhZGRpbmcgInV0Zjg9MCIgdG8gbW91bnQgb3B0aW9ucy4KLQot
CSAgU2F5IFkgaWYgeW91IHVzZSBVVEYtOCBlbmNvZGluZyBmb3IgZmlsZSBuYW1lcywgTiBvdGhl
cndpc2UuCi0KLQkgIFNlZSA8ZmlsZTpEb2N1bWVudGF0aW9uL2ZpbGVzeXN0ZW1zL3ZmYXQucnN0
PiBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KZGlmZiAtLWdpdCBhL2ZzL2ZhdC9kaXIuYyBiL2ZzL2Zh
dC9kaXIuYwppbmRleCBjNGEyNzQyODU4NTguLjQ5ZmU4ZGM2ZTVmMCAxMDA2NDQKLS0tIGEvZnMv
ZmF0L2Rpci5jCisrKyBiL2ZzL2ZhdC9kaXIuYwpAQCAtMzMsMTEgKzMzLDYgQEAKICNkZWZpbmUg
RkFUX01BWF9VTklfQ0hBUlMJKChNU0RPU19TTE9UUyAtIDEpICogMTMgKyAxKQogI2RlZmluZSBG
QVRfTUFYX1VOSV9TSVpFCShGQVRfTUFYX1VOSV9DSEFSUyAqIHNpemVvZih3Y2hhcl90KSkKIAot
c3RhdGljIGlubGluZSB1bnNpZ25lZCBjaGFyIGZhdF90b2xvd2VyKHVuc2lnbmVkIGNoYXIgYykK
LXsKLQlyZXR1cm4gKChjID49ICdBJykgJiYgKGMgPD0gJ1onKSkgPyBjKzMyIDogYzsKLX0KLQog
c3RhdGljIGlubGluZSBsb2ZmX3QgZmF0X21ha2VfaV9wb3Moc3RydWN0IHN1cGVyX2Jsb2NrICpz
YiwKIAkJCQkgICAgc3RydWN0IGJ1ZmZlcl9oZWFkICpiaCwKIAkJCQkgICAgc3RydWN0IG1zZG9z
X2Rpcl9lbnRyeSAqZGUpCkBAIC0yNTgsMTAgKzI1MywxMiBAQCBzdGF0aWMgaW5saW5lIGludCBm
YXRfbmFtZV9tYXRjaChzdHJ1Y3QgbXNkb3Nfc2JfaW5mbyAqc2JpLAogCWlmIChhX2xlbiAhPSBi
X2xlbikKIAkJcmV0dXJuIDA7CiAKLQlpZiAoc2JpLT5vcHRpb25zLm5hbWVfY2hlY2sgIT0gJ3Mn
KQotCQlyZXR1cm4gIW5sc19zdHJuaWNtcChzYmktPm5sc19pbywgYSwgYiwgYV9sZW4pOwotCWVs
c2UKKwlpZiAoc2JpLT5vcHRpb25zLm5hbWVfY2hlY2sgPT0gJ3MnKQogCQlyZXR1cm4gIW1lbWNt
cChhLCBiLCBhX2xlbik7CisJZWxzZSBpZiAoc2JpLT5vcHRpb25zLnV0ZjgpCisJCXJldHVybiAh
ZmF0X3V0Zjhfc3RybmljbXAoYSwgYiwgYV9sZW4pOworCWVsc2UKKwkJcmV0dXJuICFubHNfc3Ry
bmljbXAoc2JpLT5ubHNfaW8sIGEsIGIsIGFfbGVuKTsKIH0KIAogZW51bSB7IFBBUlNFX0lOVkFM
SUQgPSAxLCBQQVJTRV9OT1RfTE9OR05BTUUsIFBBUlNFX0VPRiwgfTsKQEAgLTM4NCw3ICszODEs
NyBAQCBzdGF0aWMgaW50IGZhdF9wYXJzZV9zaG9ydChzdHJ1Y3Qgc3VwZXJfYmxvY2sgKnNiLAog
CQkJCQlkZS0+bGNhc2UgJiBDQVNFX0xPV0VSX0JBU0UpOwogCQlpZiAoY2hsIDw9IDEpIHsKIAkJ
CWlmICghaXN2ZmF0KQotCQkJCXB0bmFtZVtpXSA9IG5vY2FzZSA/IGMgOiBmYXRfdG9sb3dlcihj
KTsKKwkJCQlwdG5hbWVbaV0gPSBub2Nhc2UgPyBjIDogZmF0X2FzY2lpX3RvX2xvd2VyKGMpOwog
CQkJaSsrOwogCQkJaWYgKGMgIT0gJyAnKSB7CiAJCQkJbmFtZV9sZW4gPSBpOwpAQCAtNDIxLDcg
KzQxOCw3IEBAIHN0YXRpYyBpbnQgZmF0X3BhcnNlX3Nob3J0KHN0cnVjdCBzdXBlcl9ibG9jayAq
c2IsCiAJCWlmIChjaGwgPD0gMSkgewogCQkJaysrOwogCQkJaWYgKCFpc3ZmYXQpCi0JCQkJcHRu
YW1lW2ldID0gbm9jYXNlID8gYyA6IGZhdF90b2xvd2VyKGMpOworCQkJCXB0bmFtZVtpXSA9IG5v
Y2FzZSA/IGMgOiBmYXRfYXNjaWlfdG9fbG93ZXIoYyk7CiAJCQlpKys7CiAJCQlpZiAoYyAhPSAn
ICcpIHsKIAkJCQluYW1lX2xlbiA9IGk7CmRpZmYgLS1naXQgYS9mcy9mYXQvZmF0LmggYi9mcy9m
YXQvZmF0LmgKaW5kZXggMDJkNGQ0MjM0OTU2Li4wY2QxNWZiM2IwNDIgMTAwNjQ0Ci0tLSBhL2Zz
L2ZhdC9mYXQuaAorKysgYi9mcy9mYXQvZmF0LmgKQEAgLTMxMCw2ICszMTAsMjggQEAgc3RhdGlj
IGlubGluZSB2b2lkIGZhdHdjaGFyX3RvMTYoX191OCAqZHN0LCBjb25zdCB3Y2hhcl90ICpzcmMs
IHNpemVfdCBsZW4pCiAjZW5kaWYKIH0KIAorc3RhdGljIGlubGluZSB1bnNpZ25lZCBjaGFyIGZh
dF9hc2NpaV90b19sb3dlcih1bnNpZ25lZCBjaGFyIGMpCit7CisJcmV0dXJuICgoYyA+PSAnQScp
ICYmIChjIDw9ICdaJykpID8gYyszMiA6IGM7Cit9CisKK3N0YXRpYyBpbmxpbmUgaW50IGZhdF91
dGY4X3N0cm5pY21wKGNvbnN0IHVuc2lnbmVkIGNoYXIgKmEsCisJCQkJICAgIGNvbnN0IHVuc2ln
bmVkIGNoYXIgKmIsCisJCQkJICAgIGludCBsZW4pCit7CisJaW50IGk7CisKKwkvKgorCSAqIEZJ
WE1FOiBVVEYtOCBkb2Vzbid0IHByb3ZpZGUgRkFUIHNlbWFudGljcworCSAqIENhc2UtaW5zZW5z
aXRpdmUgc3VwcG9ydCBpcyBvbmx5IGZvciA3LWJpdCBBU0NJSSBjaGFyYWN0ZXJzCisJICovCisJ
Zm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7CisJCWlmIChmYXRfYXNjaWlfdG9fbG93ZXIoYVtp
XSkgIT0gZmF0X2FzY2lpX3RvX2xvd2VyKGJbaV0pKQorCQkJcmV0dXJuIDE7CisJfQorCXJldHVy
biAwOworfQorCiAvKiBmYXQvY2FjaGUuYyAqLwogZXh0ZXJuIHZvaWQgZmF0X2NhY2hlX2ludmFs
X2lub2RlKHN0cnVjdCBpbm9kZSAqaW5vZGUpOwogZXh0ZXJuIGludCBmYXRfZ2V0X2NsdXN0ZXIo
c3RydWN0IGlub2RlICppbm9kZSwgaW50IGNsdXN0ZXIsCmRpZmYgLS1naXQgYS9mcy9mYXQvaW5v
ZGUuYyBiL2ZzL2ZhdC9pbm9kZS5jCmluZGV4IGRlMGM5YjAxM2E4NS4uZjhjOGE3MzlmOGYwIDEw
MDY0NAotLS0gYS9mcy9mYXQvaW5vZGUuYworKysgYi9mcy9mYXQvaW5vZGUuYwpAQCAtOTU3LDcg
Kzk1Nyw5IEBAIHN0YXRpYyBpbnQgZmF0X3Nob3dfb3B0aW9ucyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0s
IHN0cnVjdCBkZW50cnkgKnJvb3QpCiAJCS8qIHN0cmlwICJjcCIgcHJlZml4IGZyb20gZGlzcGxh
eWVkIG9wdGlvbiAqLwogCQlzZXFfcHJpbnRmKG0sICIsY29kZXBhZ2U9JXMiLCAmc2JpLT5ubHNf
ZGlzay0+Y2hhcnNldFsyXSk7CiAJaWYgKGlzdmZhdCkgewotCQlpZiAoc2JpLT5ubHNfaW8pCisJ
CWlmIChvcHRzLT51dGY4KQorCQkJc2VxX3ByaW50ZihtLCAiLGlvY2hhcnNldD11dGY4Iik7CisJ
CWVsc2UgaWYgKHNiaS0+bmxzX2lvKQogCQkJc2VxX3ByaW50ZihtLCAiLGlvY2hhcnNldD0lcyIs
IHNiaS0+bmxzX2lvLT5jaGFyc2V0KTsKIAogCQlzd2l0Y2ggKG9wdHMtPnNob3J0bmFtZSkgewpA
QCAtOTk0LDggKzk5Niw2IEBAIHN0YXRpYyBpbnQgZmF0X3Nob3dfb3B0aW9ucyhzdHJ1Y3Qgc2Vx
X2ZpbGUgKm0sIHN0cnVjdCBkZW50cnkgKnJvb3QpCiAJCWlmIChvcHRzLT5ub2Nhc2UpCiAJCQlz
ZXFfcHV0cyhtLCAiLG5vY2FzZSIpOwogCX0gZWxzZSB7Ci0JCWlmIChvcHRzLT51dGY4KQotCQkJ
c2VxX3B1dHMobSwgIix1dGY4Iik7CiAJCWlmIChvcHRzLT51bmljb2RlX3hsYXRlKQogCQkJc2Vx
X3B1dHMobSwgIix1bmlfeGxhdGUiKTsKIAkJaWYgKCFvcHRzLT5udW10YWlsKQpAQCAtMTE1Nyw4
ICsxMTU3LDYgQEAgc3RhdGljIGludCBwYXJzZV9vcHRpb25zKHN0cnVjdCBzdXBlcl9ibG9jayAq
c2IsIGNoYXIgKm9wdGlvbnMsIGludCBpc192ZmF0LAogCW9wdHMtPmVycm9ycyA9IEZBVF9FUlJP
UlNfUk87CiAJKmRlYnVnID0gMDsKIAotCW9wdHMtPnV0ZjggPSBJU19FTkFCTEVEKENPTkZJR19G
QVRfREVGQVVMVF9VVEY4KSAmJiBpc192ZmF0OwotCiAJaWYgKCFvcHRpb25zKQogCQlnb3RvIG91
dDsKIApAQCAtMTMxOSwxMCArMTMxNywxNCBAQCBzdGF0aWMgaW50IHBhcnNlX29wdGlvbnMoc3Ry
dWN0IHN1cGVyX2Jsb2NrICpzYiwgY2hhciAqb3B0aW9ucywgaW50IGlzX3ZmYXQsCiAJCQkJCXwg
VkZBVF9TRk5fQ1JFQVRFX1dJTjk1OwogCQkJYnJlYWs7CiAJCWNhc2UgT3B0X3V0Zjhfbm86CQkv
KiAwIG9yIG5vIG9yIGZhbHNlICovCi0JCQlvcHRzLT51dGY4ID0gMDsKKwkJCWZhdF9yZXNldF9p
b2NoYXJzZXQob3B0cyk7CiAJCQlicmVhazsKIAkJY2FzZSBPcHRfdXRmOF95ZXM6CQkvKiBlbXB0
eSBvciAxIG9yIHllcyBvciB0cnVlICovCi0JCQlvcHRzLT51dGY4ID0gMTsKKwkJCWZhdF9yZXNl
dF9pb2NoYXJzZXQob3B0cyk7CisJCQlpb2NoYXJzZXQgPSBrc3RyZHVwKCJ1dGY4IiwgR0ZQX0tF
Uk5FTCk7CisJCQlpZiAoIWlvY2hhcnNldCkKKwkJCQlyZXR1cm4gLUVOT01FTTsKKwkJCW9wdHMt
PmlvY2hhcnNldCA9IGlvY2hhcnNldDsKIAkJCWJyZWFrOwogCQljYXNlIE9wdF91bmlfeGxfbm86
CQkvKiAwIG9yIG5vIG9yIGZhbHNlICovCiAJCQlvcHRzLT51bmljb2RlX3hsYXRlID0gMDsKQEAg
LTEzNjAsMTggKzEzNjIsMTEgQEAgc3RhdGljIGludCBwYXJzZV9vcHRpb25zKHN0cnVjdCBzdXBl
cl9ibG9jayAqc2IsIGNoYXIgKm9wdGlvbnMsIGludCBpc192ZmF0LAogCX0KIAogb3V0OgotCS8q
IFVURi04IGRvZXNuJ3QgcHJvdmlkZSBGQVQgc2VtYW50aWNzICovCi0JaWYgKCFzdHJjbXAob3B0
cy0+aW9jaGFyc2V0LCAidXRmOCIpKSB7Ci0JCWZhdF9tc2coc2IsIEtFUk5fV0FSTklORywgInV0
ZjggaXMgbm90IGEgcmVjb21tZW5kZWQgSU8gY2hhcnNldCIKLQkJICAgICAgICIgZm9yIEZBVCBm
aWxlc3lzdGVtcywgZmlsZXN5c3RlbSB3aWxsIGJlICIKLQkJICAgICAgICJjYXNlIHNlbnNpdGl2
ZSEiKTsKLQl9CisJb3B0cy0+dXRmOCA9ICFzdHJjbXAob3B0cy0+aW9jaGFyc2V0LCAidXRmOCIp
ICYmIGlzX3ZmYXQ7CiAKIAkvKiBJZiB1c2VyIGRvZXNuJ3Qgc3BlY2lmeSBhbGxvd191dGltZSwg
aXQncyBpbml0aWFsaXplZCBmcm9tIGRtYXNrLiAqLwogCWlmIChvcHRzLT5hbGxvd191dGltZSA9
PSAodW5zaWduZWQgc2hvcnQpLTEpCiAJCW9wdHMtPmFsbG93X3V0aW1lID0gfm9wdHMtPmZzX2Rt
YXNrICYgKFNfSVdHUlAgfCBTX0lXT1RIKTsKLQlpZiAob3B0cy0+dW5pY29kZV94bGF0ZSkKLQkJ
b3B0cy0+dXRmOCA9IDA7CiAJaWYgKG9wdHMtPm5mcyA9PSBGQVRfTkZTX05PU1RBTEVfUk8pIHsK
IAkJc2ItPnNfZmxhZ3MgfD0gU0JfUkRPTkxZOwogCQlzYi0+c19leHBvcnRfb3AgPSAmZmF0X2V4
cG9ydF9vcHNfbm9zdGFsZTsKQEAgLTE4MzIsOCArMTgyNyw3IEBAIGludCBmYXRfZmlsbF9zdXBl
cihzdHJ1Y3Qgc3VwZXJfYmxvY2sgKnNiLCB2b2lkICpkYXRhLCBpbnQgc2lsZW50LCBpbnQgaXN2
ZmF0LAogCQlnb3RvIG91dF9mYWlsOwogCX0KIAotCS8qIEZJWE1FOiB1dGY4IGlzIHVzaW5nIGlv
Y2hhcnNldCBmb3IgdXBwZXIvbG93ZXIgY29udmVyc2lvbiAqLwotCWlmIChzYmktPm9wdGlvbnMu
aXN2ZmF0KSB7CisJaWYgKHNiaS0+b3B0aW9ucy5pc3ZmYXQgJiYgIXNiaS0+b3B0aW9ucy51dGY4
KSB7CiAJCXNiaS0+bmxzX2lvID0gbG9hZF9ubHMoc2JpLT5vcHRpb25zLmlvY2hhcnNldCk7CiAJ
CWlmICghc2JpLT5ubHNfaW8pIHsKIAkJCWZhdF9tc2coc2IsIEtFUk5fRVJSLCAiSU8gY2hhcnNl
dCAlcyBub3QgZm91bmQiLApkaWZmIC0tZ2l0IGEvZnMvZmF0L25hbWVpX3ZmYXQuYyBiL2ZzL2Zh
dC9uYW1laV92ZmF0LmMKaW5kZXggNTM2OWQ4MmUwYmZiLi5lZmIzY2I5ZWE4YTggMTAwNjQ0Ci0t
LSBhL2ZzL2ZhdC9uYW1laV92ZmF0LmMKKysrIGIvZnMvZmF0L25hbWVpX3ZmYXQuYwpAQCAtMTM0
LDYgKzEzNCw3IEBAIHN0YXRpYyBpbnQgdmZhdF9oYXNoKGNvbnN0IHN0cnVjdCBkZW50cnkgKmRl
bnRyeSwgc3RydWN0IHFzdHIgKnFzdHIpCiBzdGF0aWMgaW50IHZmYXRfaGFzaGkoY29uc3Qgc3Ry
dWN0IGRlbnRyeSAqZGVudHJ5LCBzdHJ1Y3QgcXN0ciAqcXN0cikKIHsKIAlzdHJ1Y3QgbmxzX3Rh
YmxlICp0ID0gTVNET1NfU0IoZGVudHJ5LT5kX3NiKS0+bmxzX2lvOworCWludCB1dGY4ID0gTVNE
T1NfU0IoZGVudHJ5LT5kX3NiKS0+b3B0aW9ucy51dGY4OwogCWNvbnN0IHVuc2lnbmVkIGNoYXIg
Km5hbWU7CiAJdW5zaWduZWQgaW50IGxlbjsKIAl1bnNpZ25lZCBsb25nIGhhc2g7CkBAIC0xNDIs
OCArMTQzLDE3IEBAIHN0YXRpYyBpbnQgdmZhdF9oYXNoaShjb25zdCBzdHJ1Y3QgZGVudHJ5ICpk
ZW50cnksIHN0cnVjdCBxc3RyICpxc3RyKQogCWxlbiA9IHZmYXRfc3RyaXB0YWlsX2xlbihxc3Ry
KTsKIAogCWhhc2ggPSBpbml0X25hbWVfaGFzaChkZW50cnkpOwotCXdoaWxlIChsZW4tLSkKLQkJ
aGFzaCA9IHBhcnRpYWxfbmFtZV9oYXNoKG5sc190b2xvd2VyKHQsICpuYW1lKyspLCBoYXNoKTsK
KwlpZiAodXRmOCkgeworCQkvKgorCQkgKiBGSVhNRTogVVRGLTggZG9lc24ndCBwcm92aWRlIEZB
VCBzZW1hbnRpY3MKKwkJICogQ2FzZS1pbnNlbnNpdGl2ZSBzdXBwb3J0IGlzIG9ubHkgZm9yIDct
Yml0IEFTQ0lJIGNoYXJhY3RlcnMKKwkJICovCisJCXdoaWxlIChsZW4tLSkKKwkJCWhhc2ggPSBw
YXJ0aWFsX25hbWVfaGFzaChmYXRfYXNjaWlfdG9fbG93ZXIoKm5hbWUrKyksIGhhc2gpOworCX0g
ZWxzZSB7CisJCXdoaWxlIChsZW4tLSkKKwkJCWhhc2ggPSBwYXJ0aWFsX25hbWVfaGFzaChubHNf
dG9sb3dlcih0LCAqbmFtZSsrKSwgaGFzaCk7CisJfQogCXFzdHItPmhhc2ggPSBlbmRfbmFtZV9o
YXNoKGhhc2gpOwogCiAJcmV0dXJuIDA7CkBAIC0xNTYsMTYgKzE2NiwxOCBAQCBzdGF0aWMgaW50
IHZmYXRfY21waShjb25zdCBzdHJ1Y3QgZGVudHJ5ICpkZW50cnksCiAJCXVuc2lnbmVkIGludCBs
ZW4sIGNvbnN0IGNoYXIgKnN0ciwgY29uc3Qgc3RydWN0IHFzdHIgKm5hbWUpCiB7CiAJc3RydWN0
IG5sc190YWJsZSAqdCA9IE1TRE9TX1NCKGRlbnRyeS0+ZF9zYiktPm5sc19pbzsKKwlpbnQgdXRm
OCA9IE1TRE9TX1NCKGRlbnRyeS0+ZF9zYiktPm9wdGlvbnMudXRmODsKIAl1bnNpZ25lZCBpbnQg
YWxlbiwgYmxlbjsKIAogCS8qIEEgZmlsZW5hbWUgY2Fubm90IGVuZCBpbiAnLicgb3Igd2UgdHJl
YXQgaXQgbGlrZSBpdCBoYXMgbm9uZSAqLwogCWFsZW4gPSB2ZmF0X3N0cmlwdGFpbF9sZW4obmFt
ZSk7CiAJYmxlbiA9IF9fdmZhdF9zdHJpcHRhaWxfbGVuKGxlbiwgc3RyKTsKLQlpZiAoYWxlbiA9
PSBibGVuKSB7Ci0JCWlmIChubHNfc3RybmljbXAodCwgbmFtZS0+bmFtZSwgc3RyLCBhbGVuKSA9
PSAwKQotCQkJcmV0dXJuIDA7Ci0JfQotCXJldHVybiAxOworCWlmIChhbGVuICE9IGJsZW4pCisJ
CXJldHVybiAxOworCWVsc2UgaWYgKHV0ZjgpCisJCXJldHVybiBmYXRfdXRmOF9zdHJuaWNtcChu
YW1lLT5uYW1lLCBzdHIsIGFsZW4pOworCWVsc2UKKwkJcmV0dXJuIG5sc19zdHJuaWNtcCh0LCBu
YW1lLT5uYW1lLCBzdHIsIGFsZW4pOwogfQogCiAvKgotLSAKMi4yMC4xCgoKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkxpbnV4LU5URlMtRGV2IG1haWxp
bmcgbGlzdApMaW51eC1OVEZTLURldkBsaXN0cy5zb3VyY2Vmb3JnZS5uZXQKaHR0cHM6Ly9saXN0
cy5zb3VyY2Vmb3JnZS5uZXQvbGlzdHMvbGlzdGluZm8vbGludXgtbnRmcy1kZXYK
