Return-Path: <linux-ntfs-dev-bounces@lists.sourceforge.net>
X-Original-To: lists+linux-ntfs-dev@lfdr.de
Delivered-To: lists+linux-ntfs-dev@lfdr.de
Received: from lists.sourceforge.net (lists.sourceforge.net [216.105.38.7])
	by mail.lfdr.de (Postfix) with ESMTPS id 1E9D63E3C6D
	for <lists+linux-ntfs-dev@lfdr.de>; Sun,  8 Aug 2021 21:06:37 +0200 (CEST)
Received: from [127.0.0.1] (helo=sfs-ml-1.v29.lw.sourceforge.com)
	by sfs-ml-1.v29.lw.sourceforge.com with esmtp (Exim 4.90_1)
	(envelope-from <linux-ntfs-dev-bounces@lists.sourceforge.net>)
	id 1mCo82-0004nJ-7f; Sun, 08 Aug 2021 19:06:34 +0000
Received: from [172.30.20.202] (helo=mx.sourceforge.net)
 by sfs-ml-2.v29.lw.sourceforge.com with esmtps
 (TLSv1.2:ECDHE-RSA-AES256-GCM-SHA384:256) (Exim 4.92.3)
 (envelope-from <pali@kernel.org>)
 id 1mClcJ-0005gE-C5; Sun, 08 Aug 2021 16:25:39 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
 d=sourceforge.net; s=x; h=Content-Transfer-Encoding:Content-Type:MIME-Version
 :References:In-Reply-To:Message-Id:Date:Subject:To:From:Sender:Reply-To:Cc:
 Content-ID:Content-Description:Resent-Date:Resent-From:Resent-Sender:
 Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:List-Unsubscribe:
 List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=eHbaetOKiO4E2ukyz3XlwYF865r/Rrt2mofAyfqeXco=; b=ZiqUZK4WyU5CyQ4VloIoF5RkFL
 a2SHzCooM55kLCuW4FTHCIbGNsdVDJskCI72/DGmgJbbbJpQKDHxHszYpTfwIDP9wadyY8GWiGnWL
 GS0Nw9rodaev7RIk97zlMhK6Kp29tGHJeO1XrSvVSV6J448M4Z261RzKuvVRiP2/23WY=;
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; d=sf.net; s=x
 ;
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:
 In-Reply-To:Message-Id:Date:Subject:To:From:Sender:Reply-To:Cc:Content-ID:
 Content-Description:Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc
 :Resent-Message-ID:List-Id:List-Help:List-Unsubscribe:List-Subscribe:
 List-Post:List-Owner:List-Archive;
 bh=eHbaetOKiO4E2ukyz3XlwYF865r/Rrt2mofAyfqeXco=; b=DukZ0Yi7mtdsSC+e6TuqCOwteq
 50DIG0pAtay6tkBb8SNnMmcihIbdH15JjQ5ucWALHkgtlGd1TlgJW10qIrHhr6ejOSg3EQ1M5Z2W2
 Qrgngj0S0h//Z9OZZWQfdc0FAQ7hFQPPLtlIdO2I2iRY8vQeJVSiJOMOiQd7OK2dMMZU=;
Received: from mail.kernel.org ([198.145.29.99])
 by sfi-mx-1.v28.lw.sourceforge.com with esmtps
 (TLSv1.2:ECDHE-RSA-AES256-GCM-SHA384:256) (Exim 4.92.3)
 id 1mClcE-00GyXb-Fk; Sun, 08 Aug 2021 16:25:39 +0000
Received: by mail.kernel.org (Postfix) with ESMTPSA id 7CCC061159;
 Sun,  8 Aug 2021 16:25:21 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=k20201202; t=1628439921;
 bh=z/FhqL9hG3wsAsCw14eqfq6cdKCY6sXwbLTyVeyWntw=;
 h=From:To:Subject:Date:In-Reply-To:References:From;
 b=eGaZ5eaTBGadLSABdqluDPMNhsqP/wYRtcVcsjA5pSDpnP9/4mP259wjzz/CPWuqr
 bri5qcFT3o6QCGpF1b1c4cq9uYgsm8tooRc9TRbbtp5g3gyjo9SyTfVwbSzL+MCaSK
 TBVbCixDf70sxwy4hRbJCd3CKGwzY8Dux+JxLv1E0QiCgqHXOH95md7XqSbJlVEObI
 PojIcURWFuuMzoZqi7g04Hd6mZyyiLTKAEO9KNJ4YOlxZkwbPH2c14VZj1DAryDntR
 rPyv6tIYuKcHdgZyhHOe2JUT/4Z7Dpm6foeLVgBilLuCdF9a5OYENrJo8+oGaNMPkq
 mnjvdHV7tieiA==
Received: by pali.im (Postfix)
 id 3DCD413DC; Sun,  8 Aug 2021 18:25:21 +0200 (CEST)
From: =?UTF-8?q?Pali=20Roh=C3=A1r?= <pali@kernel.org>
To: linux-fsdevel@vger.kernel.org, linux-ntfs-dev@lists.sourceforge.net,
 linux-cifs@vger.kernel.org, jfs-discussion@lists.sourceforge.net,
 linux-kernel@vger.kernel.org, Alexander Viro <viro@zeniv.linux.org.uk>,
 Jan Kara <jack@suse.cz>, OGAWA Hirofumi <hirofumi@mail.parknet.co.jp>,
 "Theodore Y . Ts'o" <tytso@mit.edu>,
 Luis de Bethencourt <luisbg@kernel.org>,
 Salah Triki <salah.triki@gmail.com>,
 Andrew Morton <akpm@linux-foundation.org>,
 Dave Kleikamp <shaggy@kernel.org>, Anton Altaparmakov <anton@tuxera.com>,
 Pavel Machek <pavel@ucw.cz>,
 =?UTF-8?q?Marek=20Beh=C3=BAn?= <marek.behun@nic.cz>,
 Christoph Hellwig <hch@infradead.org>
Date: Sun,  8 Aug 2021 18:24:50 +0200
Message-Id: <20210808162453.1653-18-pali@kernel.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20210808162453.1653-1-pali@kernel.org>
References: <20210808162453.1653-1-pali@kernel.org>
MIME-Version: 1.0
X-Spam-Score: -0.8 (/)
X-Spam-Report: Spam Filtering performed by mx.sourceforge.net.
 See http://spamassassin.org/tag/ for more details.
 -0.0 SPF_PASS               SPF: sender matches SPF record
 0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from author's
 domain
 -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
 0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.7 DKIMWL_WL_HIGH         DKIMwl.org - High trust sender
X-Headers-End: 1mClcE-00GyXb-Fk
X-Mailman-Approved-At: Sun, 08 Aug 2021 19:06:30 +0000
Subject: [Linux-NTFS-Dev] [RFC PATCH 17/20] ntfs: Do not use broken utf8 NLS
 table for iocharset=utf8 mount option
X-BeenThere: linux-ntfs-dev@lists.sourceforge.net
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: "Discussion related to Linux NTFS development."
 <linux-ntfs-dev.lists.sourceforge.net>
List-Unsubscribe: <https://lists.sourceforge.net/lists/options/linux-ntfs-dev>, 
 <mailto:linux-ntfs-dev-request@lists.sourceforge.net?subject=unsubscribe>
List-Archive: <http://sourceforge.net/mailarchive/forum.php?forum_name=linux-ntfs-dev>
List-Post: <mailto:linux-ntfs-dev@lists.sourceforge.net>
List-Help: <mailto:linux-ntfs-dev-request@lists.sourceforge.net?subject=help>
List-Subscribe: <https://lists.sourceforge.net/lists/listinfo/linux-ntfs-dev>, 
 <mailto:linux-ntfs-dev-request@lists.sourceforge.net?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linux-ntfs-dev-bounces@lists.sourceforge.net

TkxTIHRhYmxlIGZvciB1dGY4IGlzIGJyb2tlbiBhbmQgY2Fubm90IGJlIGZpeGVkLgoKU28gaW5z
dGVhZCBvZiBicm9rZW4gdXRmOCBubHMgZnVuY3Rpb25zIGNoYXIydW5pKCkgYW5kIHVuaTJjaGFy
KCkgdXNlCmZ1bmN0aW9ucyB1dGY4c190b191dGYxNnMoKSBhbmQgdXRmMTZzX3RvX3V0ZjhzKCkg
d2hpY2ggaW1wbGVtZW50cyBjb3JyZWN0CmNvbnZlcnNpb24gYmV0d2VlbiBVVEYtMTYgYW5kIFVU
Ri04LgoKVGhlc2UgZnVuY3Rpb25zIGltcGxlbWVudHMgYWxzbyBjb3JyZWN0IHByb2Nlc3Npbmcg
b2YgVVRGLTE2IHN1cnJvZ2F0ZQpwYWlycyBhbmQgdGhlcmVmb3JlIGFmdGVyIHRoaXMgY2hhbmdl
IG50ZnMgZHJpdmVyIHdvdWxkIGJlIGFibGUgdG8gY29ycmVjdGx5CmhhbmRsZSBhbHNvIGZpbGUg
bmFtZXMgd2l0aCA0LWJ5dGUgVVRGLTggc2VxdWVuY2VzLgoKV2hlbiBpb2NoYXRzZXQ9dXRmOCBp
cyB1c2VkIHRoZW4gc2V0IHZvbC0+bmxzX21hcCB0byBOVUxMIGFuZCB1c2UgaXQgZm9yCmRpc3Rp
bmd1aXNoIGJldHdlZW4gdGhlIGZhY3QgaWYgTkxTIHRhYmxlIG9yIG5hdGl2ZSBVVEYtOCBmdW5j
dGlvbnMgc2hvdWxkCmJlIHVzZWQuCgpTaWduZWQtb2ZmLWJ5OiBQYWxpIFJvaMOhciA8cGFsaUBr
ZXJuZWwub3JnPgotLS0KIGZzL250ZnMvZGlyLmMgICAgfCAgNiArKysrLS0KIGZzL250ZnMvaW5v
ZGUuYyAgfCAgNSArKysrLQogZnMvbnRmcy9zdXBlci5jICB8IDQxICsrKysrKysrKysrKysrKysr
KysrKysrKy0tLS0tLS0tLS0tLS0tLS0tCiBmcy9udGZzL3VuaXN0ci5jIHwgMjcgKysrKysrKysr
KysrKysrKysrKysrKysrLS0tCiA0IGZpbGVzIGNoYW5nZWQsIDU2IGluc2VydGlvbnMoKyksIDIz
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2ZzL250ZnMvZGlyLmMgYi9mcy9udGZzL2Rpci5j
CmluZGV4IGNkOTYwODNhMTJjOC4uMDM1NTgyYjkyYWEyIDEwMDY0NAotLS0gYS9mcy9udGZzL2Rp
ci5jCisrKyBiL2ZzL250ZnMvZGlyLmMKQEAgLTEwMzQsNyArMTAzNCw4IEBAIHN0YXRpYyBpbmxp
bmUgaW50IG50ZnNfZmlsbGRpcihudGZzX3ZvbHVtZSAqdm9sLAogCX0KIAluYW1lX2xlbiA9IG50
ZnNfdWNzdG9ubHModm9sLCAobnRmc2NoYXIqKSZpZS0+a2V5LmZpbGVfbmFtZS5maWxlX25hbWUs
CiAJCQlpZS0+a2V5LmZpbGVfbmFtZS5maWxlX25hbWVfbGVuZ3RoLCAmbmFtZSwKLQkJCU5URlNf
TUFYX05BTUVfTEVOICogTkxTX01BWF9DSEFSU0VUX1NJWkUgKyAxKTsKKwkJCU5URlNfTUFYX05B
TUVfTEVOICoKKwkJCSh2b2wtPm5sc19tYXAgPyBOTFNfTUFYX0NIQVJTRVRfU0laRSA6IDQpICsg
MSk7CiAJaWYgKG5hbWVfbGVuIDw9IDApIHsKIAkJbnRmc193YXJuaW5nKHZvbC0+c2IsICJTa2lw
cGluZyB1bnJlcHJlc2VudGFibGUgaW5vZGUgMHglbGx4LiIsCiAJCQkJKGxvbmcgbG9uZylNUkVG
X0xFKGllLT5kYXRhLmRpci5pbmRleGVkX2ZpbGUpKTsKQEAgLTExMTgsNyArMTExOSw4IEBAIHN0
YXRpYyBpbnQgbnRmc19yZWFkZGlyKHN0cnVjdCBmaWxlICpmaWxlLCBzdHJ1Y3QgZGlyX2NvbnRl
eHQgKmFjdG9yKQogCSAqIEFsbG9jYXRlIGEgYnVmZmVyIHRvIHN0b3JlIHRoZSBjdXJyZW50IG5h
bWUgYmVpbmcgcHJvY2Vzc2VkCiAJICogY29udmVydGVkIHRvIGZvcm1hdCBkZXRlcm1pbmVkIGJ5
IGN1cnJlbnQgTkxTLgogCSAqLwotCW5hbWUgPSBrbWFsbG9jKE5URlNfTUFYX05BTUVfTEVOICog
TkxTX01BWF9DSEFSU0VUX1NJWkUgKyAxLCBHRlBfTk9GUyk7CisJbmFtZSA9IGttYWxsb2MoTlRG
U19NQVhfTkFNRV9MRU4gKgorCQkgICAgICAgKHZvbC0+bmxzX21hcCA/IE5MU19NQVhfQ0hBUlNF
VF9TSVpFIDogNCkgKyAxLCBHRlBfTk9GUyk7CiAJaWYgKHVubGlrZWx5KCFuYW1lKSkgewogCQll
cnIgPSAtRU5PTUVNOwogCQlnb3RvIGVycl9vdXQ7CmRpZmYgLS1naXQgYS9mcy9udGZzL2lub2Rl
LmMgYi9mcy9udGZzL2lub2RlLmMKaW5kZXggMzY3NmYxODViNGEwLi4xNDM3OTQ0YmU2NmQgMTAw
NjQ0Ci0tLSBhL2ZzL250ZnMvaW5vZGUuYworKysgYi9mcy9udGZzL2lub2RlLmMKQEAgLTIzMDMs
NyArMjMwMywxMCBAQCBpbnQgbnRmc19zaG93X29wdGlvbnMoc3RydWN0IHNlcV9maWxlICpzZiwg
c3RydWN0IGRlbnRyeSAqcm9vdCkKIAkJc2VxX3ByaW50ZihzZiwgIixmbWFzaz0wJW8iLCB2b2wt
PmZtYXNrKTsKIAkJc2VxX3ByaW50ZihzZiwgIixkbWFzaz0wJW8iLCB2b2wtPmRtYXNrKTsKIAl9
Ci0Jc2VxX3ByaW50ZihzZiwgIixpb2NoYXJzZXQ9JXMiLCB2b2wtPm5sc19tYXAtPmNoYXJzZXQp
OworCWlmICh2b2wtPm5sc19tYXApCisJCXNlcV9wcmludGYoc2YsICIsaW9jaGFyc2V0PSVzIiwg
dm9sLT5ubHNfbWFwLT5jaGFyc2V0KTsKKwllbHNlCisJCXNlcV9wdXRzKHNmLCAiLGlvY2hhcnNl
dD11dGY4Iik7CiAJaWYgKE5Wb2xDYXNlU2Vuc2l0aXZlKHZvbCkpCiAJCXNlcV9wcmludGYoc2Ys
ICIsY2FzZV9zZW5zaXRpdmUiKTsKIAlpZiAoTlZvbFNob3dTeXN0ZW1GaWxlcyh2b2wpKQpkaWZm
IC0tZ2l0IGEvZnMvbnRmcy9zdXBlci5jIGIvZnMvbnRmcy9zdXBlci5jCmluZGV4IDY5Yzc4NzFi
NzQyZS4uMzU4ZjVlOWUzYzQ2IDEwMDY0NAotLS0gYS9mcy9udGZzL3N1cGVyLmMKKysrIGIvZnMv
bnRmcy9zdXBlci5jCkBAIC04NCw3ICs4NCw3IEBAIHN0YXRpYyBpbnQgc2ltcGxlX2dldGJvb2wo
Y2hhciAqcywgYm9vbCAqc2V0dmFsKQogICoKICAqIFBhcnNlIHRoZSByZWNvZ25pemVkIG9wdGlv
bnMgaW4gQG9wdCBmb3IgdGhlIG50ZnMgdm9sdW1lIGRlc2NyaWJlZCBieSBAdm9sLgogICovCi1z
dGF0aWMgYm9vbCBwYXJzZV9vcHRpb25zKG50ZnNfdm9sdW1lICp2b2wsIGNoYXIgKm9wdCkKK3N0
YXRpYyBib29sIHBhcnNlX29wdGlvbnMobnRmc192b2x1bWUgKnZvbCwgY2hhciAqb3B0LCBpbnQg
cmVtb3VudCkKIHsKIAljaGFyICpwLCAqdiwgKm92OwogCXN0YXRpYyBjaGFyICp1dGY4ID0gInV0
ZjgiOwpAQCAtOTUsNiArOTUsNyBAQCBzdGF0aWMgYm9vbCBwYXJzZV9vcHRpb25zKG50ZnNfdm9s
dW1lICp2b2wsIGNoYXIgKm9wdCkKIAlpbnQgbWZ0X3pvbmVfbXVsdGlwbGllciA9IC0xLCBvbl9l
cnJvcnMgPSAtMTsKIAlpbnQgc2hvd19zeXNfZmlsZXMgPSAtMSwgY2FzZV9zZW5zaXRpdmUgPSAt
MSwgZGlzYWJsZV9zcGFyc2UgPSAtMTsKIAlzdHJ1Y3QgbmxzX3RhYmxlICpubHNfbWFwID0gTlVM
TDsKKwlpbnQgaGF2ZV9pb2NoYXJzZXQgPSAwOwogCiAJLyogSSBhbSBsYXp5Li4uICgtOCAqLwog
I2RlZmluZSBOVEZTX0dFVE9QVF9XSVRIX0RFRkFVTFQob3B0aW9uLCB2YXJpYWJsZSwgZGVmYXVs
dF92YWx1ZSkJXApAQCAtMTk2LDEyICsxOTcsMTYgQEAgc3RhdGljIGJvb2wgcGFyc2Vfb3B0aW9u
cyhudGZzX3ZvbHVtZSAqdm9sLCBjaGFyICpvcHQpCiAJCQkJZ290byBuZWVkc19hcmc7CiB1c2Vf
dXRmODoKIAkJCXVubG9hZF9ubHMobmxzX21hcCk7Ci0JCQlubHNfbWFwID0gbG9hZF9ubHModik7
Ci0JCQlpZiAoIW5sc19tYXApIHsKLQkJCQludGZzX2Vycm9yKHZvbC0+c2IsICJOTFMgY2hhcmFj
dGVyIHNldCAiCi0JCQkJCSAgICIlcyBub3QgZm91bmQuIiwgdik7Ci0JCQkJcmV0dXJuIGZhbHNl
OworCQkJbmxzX21hcCA9IE5VTEw7CisJCQlpZiAoc3RyY21wKHYsICJ1dGY4IikgIT0gMCkgewor
CQkJCW5sc19tYXAgPSBsb2FkX25scyh2KTsKKwkJCQlpZiAoIW5sc19tYXApIHsKKwkJCQkJbnRm
c19lcnJvcih2b2wtPnNiLCAiTkxTIGNoYXJhY3RlciBzZXQgIgorCQkJCQkJICAgIiVzIG5vdCBm
b3VuZC4iLCB2KTsKKwkJCQkJcmV0dXJuIGZhbHNlOworCQkJCX0KIAkJCX0KKwkJCWhhdmVfaW9j
aGFyc2V0ID0gMTsKIAkJfSBlbHNlIGlmICghc3RyY21wKHAsICJ1dGY4IikpIHsKIAkJCWJvb2wg
dmFsID0gZmFsc2U7CiAJCQludGZzX3dhcm5pbmcodm9sLT5zYiwgIk9wdGlvbiB1dGY4IGlzIG5v
IGxvbmdlciAiCkBAIC0yNDEsMjUgKzI0NiwyNyBAQCBzdGF0aWMgYm9vbCBwYXJzZV9vcHRpb25z
KG50ZnNfdm9sdW1lICp2b2wsIGNoYXIgKm9wdCkKIAkJCXJldHVybiBmYWxzZTsKIAkJfQogCX0K
LQlpZiAobmxzX21hcCkgewotCQlpZiAodm9sLT5ubHNfbWFwICYmIHZvbC0+bmxzX21hcCAhPSBu
bHNfbWFwKSB7CisJaWYgKGhhdmVfaW9jaGFyc2V0KSB7CisJCWlmIChyZW1vdW50ICYmIHZvbC0+
bmxzX21hcCAhPSBubHNfbWFwKSB7CiAJCQludGZzX2Vycm9yKHZvbC0+c2IsICJDYW5ub3QgY2hh
bmdlIE5MUyBjaGFyYWN0ZXIgc2V0ICIKIAkJCQkJIm9uIHJlbW91bnQuIik7CiAJCQlyZXR1cm4g
ZmFsc2U7Ci0JCX0gLyogZWxzZSAoIXZvbC0+bmxzX21hcCkgKi8KLQkJbnRmc19kZWJ1ZygiVXNp
bmcgTkxTIGNoYXJhY3RlciBzZXQgJXMuIiwgbmxzX21hcC0+Y2hhcnNldCk7Ci0JCXZvbC0+bmxz
X21hcCA9IG5sc19tYXA7Ci0JfSBlbHNlIC8qICghbmxzX21hcCkgKi8gewotCQlpZiAoIXZvbC0+
bmxzX21hcCkgeworCQl9IGVsc2UgKCFyZW1vdW50KSB7CisJCQludGZzX2RlYnVnKCJVc2luZyBO
TFMgY2hhcmFjdGVyIHNldCAlcy4iLAorCQkJCQlubHNfbWFwID8gbmxzX21hcC0+Y2hhcnNldCA6
ICJ1dGY4Iik7CisJCQl2b2wtPm5sc19tYXAgPSBubHNfbWFwOworCQl9CisJfSBlbHNlIGlmICgh
cmVtb3VudCkgeworCQlpZiAoc3RyY21wKENPTkZJR19OTFNfREVGQVVMVCwgInV0ZjgiKSAhPSAw
KSB7CiAJCQl2b2wtPm5sc19tYXAgPSBsb2FkX25sc19kZWZhdWx0KCk7CiAJCQlpZiAoIXZvbC0+
bmxzX21hcCkgewogCQkJCW50ZnNfZXJyb3Iodm9sLT5zYiwgIkZhaWxlZCB0byBsb2FkIGRlZmF1
bHQgIgogCQkJCQkJIk5MUyBjaGFyYWN0ZXIgc2V0LiIpOwogCQkJCXJldHVybiBmYWxzZTsKIAkJ
CX0KLQkJCW50ZnNfZGVidWcoIlVzaW5nIGRlZmF1bHQgTkxTIGNoYXJhY3RlciBzZXQgKCVzKS4i
LAotCQkJCQl2b2wtPm5sc19tYXAtPmNoYXJzZXQpOwogCQl9CisJCW50ZnNfZGVidWcoIlVzaW5n
IGRlZmF1bHQgTkxTIGNoYXJhY3RlciBzZXQgKCVzKS4iLAorCQkJCXZvbC0+bmxzX21hcCA/IHZv
bC0+bmxzX21hcC0+Y2hhcnNldCA6ICJ1dGY4Iik7CiAJfQogCWlmIChtZnRfem9uZV9tdWx0aXBs
aWVyICE9IC0xKSB7CiAJCWlmICh2b2wtPm1mdF96b25lX211bHRpcGxpZXIgJiYgdm9sLT5tZnRf
em9uZV9tdWx0aXBsaWVyICE9CkBAIC01MzQsNyArNTQxLDcgQEAgc3RhdGljIGludCBudGZzX3Jl
bW91bnQoc3RydWN0IHN1cGVyX2Jsb2NrICpzYiwgaW50ICpmbGFncywgY2hhciAqb3B0KQogCiAJ
Ly8gVE9ETzogRGVhbCB3aXRoICpmbGFncy4KIAotCWlmICghcGFyc2Vfb3B0aW9ucyh2b2wsIG9w
dCkpCisJaWYgKCFwYXJzZV9vcHRpb25zKHZvbCwgb3B0LCAxKSkKIAkJcmV0dXJuIC1FSU5WQUw7
CiAKIAludGZzX2RlYnVnKCJEb25lLiIpOwpAQCAtMjczMSw3ICsyNzM4LDcgQEAgc3RhdGljIGlu
dCBudGZzX2ZpbGxfc3VwZXIoc3RydWN0IHN1cGVyX2Jsb2NrICpzYiwgdm9pZCAqb3B0LCBjb25z
dCBpbnQgc2lsZW50KQogCU5Wb2xTZXRTcGFyc2VFbmFibGVkKHZvbCk7CiAKIAkvKiBJbXBvcnRh
bnQgdG8gZ2V0IHRoZSBtb3VudCBvcHRpb25zIGRlYWx0IHdpdGggbm93LiAqLwotCWlmICghcGFy
c2Vfb3B0aW9ucyh2b2wsIChjaGFyKilvcHQpKQorCWlmICghcGFyc2Vfb3B0aW9ucyh2b2wsIChj
aGFyKilvcHQsIDApKQogCQlnb3RvIGVycl9vdXRfbm93OwogCiAJLyogV2Ugc3VwcG9ydCBzZWN0
b3Igc2l6ZXMgdXAgdG8gdGhlIFBBR0VfU0laRS4gKi8KZGlmZiAtLWdpdCBhL2ZzL250ZnMvdW5p
c3RyLmMgYi9mcy9udGZzL3VuaXN0ci5jCmluZGV4IDc1YTdmNzNiY2NkZC4uZjI5ZDgzZmIwOWJi
IDEwMDY0NAotLS0gYS9mcy9udGZzL3VuaXN0ci5jCisrKyBiL2ZzL250ZnMvdW5pc3RyLmMKQEAg
LTI1NCw2ICsyNTQsMTYgQEAgaW50IG50ZnNfbmxzdG91Y3MoY29uc3QgbnRmc192b2x1bWUgKnZv
bCwgY29uc3QgY2hhciAqaW5zLAogCWlmIChsaWtlbHkoaW5zKSkgewogCQl1Y3MgPSBrbWVtX2Nh
Y2hlX2FsbG9jKG50ZnNfbmFtZV9jYWNoZSwgR0ZQX05PRlMpOwogCQlpZiAobGlrZWx5KHVjcykp
IHsKKwkJCWlmICghbmxzKSB7CisJCQkJd2NfbGVuID0gdXRmOHNfdG9fdXRmMTZzKGlucywgaW5z
X2xlbiwKKwkJCQkJCVVURjE2X0xJVFRMRV9FTkRJQU4sIHVjcywKKwkJCQkJCU5URlNfTUFYX05B
TUVfTEVOKTsKKwkJCQlpZiAod2NfbGVuIDwgMCB8fCB3Y19sZW4gPj0gTlRGU19NQVhfTkFNRV9M
RU4pCisJCQkJCWdvdG8gbmFtZV9lcnI7CisJCQkJdWNzW3djX2xlbl0gPSAwOworCQkJCSpvdXRz
ID0gdWNzOworCQkJCXJldHVybiBvOworCQkJfQogCQkJZm9yIChpID0gbyA9IDA7IGkgPCBpbnNf
bGVuOyBpICs9IHdjX2xlbikgewogCQkJCXdjX2xlbiA9IG5scy0+Y2hhcjJ1bmkoaW5zICsgaSwg
aW5zX2xlbiAtIGksCiAJCQkJCQkmd2MpOwpAQCAtMjgzLDcgKzI5Myw3IEBAIGludCBudGZzX25s
c3RvdWNzKGNvbnN0IG50ZnNfdm9sdW1lICp2b2wsIGNvbnN0IGNoYXIgKmlucywKIAlpZiAod2Nf
bGVuIDwgMCkgewogCQludGZzX2Vycm9yKHZvbC0+c2IsICJOYW1lIHVzaW5nIGNoYXJhY3RlciBz
ZXQgJXMgY29udGFpbnMgIgogCQkJCSJjaGFyYWN0ZXJzIHRoYXQgY2Fubm90IGJlIGNvbnZlcnRl
ZCB0byAiCi0JCQkJIlVuaWNvZGUuIiwgbmxzLT5jaGFyc2V0KTsKKwkJCQkiVW5pY29kZS4iLCBu
bHMgPyBubHMtPmNoYXJzZXQgOiAidXRmOCIpOwogCQlpID0gLUVJTFNFUTsKIAl9IGVsc2UgLyog
aWYgKG8gPj0gTlRGU19NQVhfTkFNRV9MRU4pICovIHsKIAkJbnRmc19lcnJvcih2b2wtPnNiLCAi
TmFtZSBpcyB0b28gbG9uZyAobWF4aW11bSBsZW5ndGggZm9yIGEgIgpAQCAtMzM1LDExICszNDUs
MjIgQEAgaW50IG50ZnNfdWNzdG9ubHMoY29uc3QgbnRmc192b2x1bWUgKnZvbCwgY29uc3QgbnRm
c2NoYXIgKmlucywKIAkJCWdvdG8gY29udmVyc2lvbl9lcnI7CiAJCX0KIAkJaWYgKCFucykgewot
CQkJbnNfbGVuID0gaW5zX2xlbiAqIE5MU19NQVhfQ0hBUlNFVF9TSVpFOworCQkJbnNfbGVuID0g
aW5zX2xlbiAqIChubHMgPyBOTFNfTUFYX0NIQVJTRVRfU0laRSA6IDQpOwogCQkJbnMgPSBrbWFs
bG9jKG5zX2xlbiArIDEsIEdGUF9OT0ZTKTsKIAkJCWlmICghbnMpCiAJCQkJZ290byBtZW1fZXJy
X291dDsKIAkJfQorCQlpZiAoIW5scykgeworCQkJbyA9IHV0ZjE2c190b191dGY4cyhpbnMsIGlu
c19sZW4sIFVURjE2X0xJVFRMRV9FTkRJQU4sCisJCQkJCW5zLCBuc19sZW4pOworCQkJaWYgKG8g
Pj0gbnNfbGVuKSB7CisJCQkJd2MgPSAtRU5BTUVUT09MT05HOworCQkJCWdvdG8gY29udmVyc2lv
bl9lcnI7CisJCQl9CisJCQluc1tvXSA9IDA7CisJCQkqb3V0cyA9IG5zOworCQkJcmV0dXJuIG87
CisJCX0KIAkJZm9yIChpID0gbyA9IDA7IGkgPCBpbnNfbGVuOyBpKyspIHsKIHJldHJ5OgkJCXdj
ID0gbmxzLT51bmkyY2hhcihsZTE2X3RvX2NwdShpbnNbaV0pLCBucyArIG8sCiAJCQkJCW5zX2xl
biAtIG8pOwpAQCAtMzczLDcgKzM5NCw3IEBAIHJldHJ5OgkJCXdjID0gbmxzLT51bmkyY2hhcihs
ZTE2X3RvX2NwdShpbnNbaV0pLCBucyArIG8sCiAJbnRmc19lcnJvcih2b2wtPnNiLCAiVW5pY29k
ZSBuYW1lIGNvbnRhaW5zIGNoYXJhY3RlcnMgdGhhdCBjYW5ub3QgYmUgIgogCQkJImNvbnZlcnRl
ZCB0byBjaGFyYWN0ZXIgc2V0ICVzLiAgWW91IG1pZ2h0IHdhbnQgdG8gIgogCQkJInRyeSB0byB1
c2UgdGhlIG1vdW50IG9wdGlvbiBpb2NoYXJzZXQ9dXRmOC4iLAotCQkJbmxzLT5jaGFyc2V0KTsK
KwkJCW5scyA/IG5scy0+Y2hhcnNldCA6ICJ1dGY4Iik7CiAJaWYgKG5zICE9ICpvdXRzKQogCQlr
ZnJlZShucyk7CiAJaWYgKHdjICE9IC1FTkFNRVRPT0xPTkcpCi0tIAoyLjIwLjEKCgoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KTGludXgtTlRGUy1EZXYg
bWFpbGluZyBsaXN0CkxpbnV4LU5URlMtRGV2QGxpc3RzLnNvdXJjZWZvcmdlLm5ldApodHRwczov
L2xpc3RzLnNvdXJjZWZvcmdlLm5ldC9saXN0cy9saXN0aW5mby9saW51eC1udGZzLWRldgo=
